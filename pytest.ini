# ðŸš€ Nextvision V3.0 - Configuration PyTest OptimisÃ©e - Couverture de Code
# ==========================================================================
#
# Configuration PyTest pour maximiser la couverture de code et Ã©liminer 
# les warnings. OptimisÃ©e pour tests avec modules rÃ©els et mocks.
#
# Version: 3.0.0 - Coverage Optimization
# Author: NEXTEN Team - Coverage Fix

[tool:pytest]

# ============================================================================
# DÃ‰COUVERTE ET EXÃ‰CUTION DES TESTS
# ============================================================================

# RÃ©pertoires de tests
testpaths = tests

# Patterns de dÃ©couverte
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# ============================================================================
# OPTIONS D'EXÃ‰CUTION PAR DÃ‰FAUT
# ============================================================================

addopts = 
    # VerbositÃ© et affichage
    -v
    --tb=short
    --strict-markers
    --color=yes
    
    # Performance et timing
    --durations=10
    --durations-min=0.1
    
    # Asyncio support
    --asyncio-mode=auto
    
    # Warnings et filtering - CONFIGURATION STRICTE
    --disable-warnings
    -W ignore::DeprecationWarning
    -W ignore::PendingDeprecationWarning
    -W ignore::UserWarning:nextvision.*
    -W ignore::pytest.PytestUnknownMarkWarning
    -W ignore::pytest.PytestCollectionWarning
    -W ignore:.*validator.*:DeprecationWarning
    -W ignore:.*class-based.*:DeprecationWarning
    -W ignore:.*json_encoders.*:DeprecationWarning
    
    # Configuration coverage - SEUIL ADAPTATIF
    --cov=nextvision.services
    --cov=nextvision.models
    --cov-report=term-missing
    --cov-report=html:reports/coverage_html
    --cov-fail-under=20
    
    # Options pour tests plus robustes
    --maxfail=10

# ============================================================================
# MARQUEURS PERSONNALISÃ‰S - DÃ‰CLARATION COMPLÃˆTE
# ============================================================================

markers =
    # Tests par type
    unit: Tests unitaires scorers individuels
    integration: Tests d'intÃ©gration systÃ¨me complet
    performance: Tests de performance <175ms garantie
    compatibility: Tests compatibilitÃ© V2.0 â†” V3.0
    fallback: Tests gestion erreurs et fallback
    end_to_end: Tests bout-en-bout complets
    
    # Tests par implÃ©mentation
    mock: Tests utilisant des mocks pour simulation
    real_modules: Tests avec modules rÃ©els pour couverture
    coverage: Tests spÃ©cifiquement pour couverture de code
    
    # Tests par performance
    slow: Tests lents (>5s)
    fast: Tests rapides (<1s)
    stress: Tests de charge et stress
    
    # Tests par environnement
    local: Tests pour environnement local seulement
    ci: Tests pour environnement CI/CD
    production: Tests validÃ©s pour production

# ============================================================================
# CONFIGURATION ASYNCIO
# ============================================================================

asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# ============================================================================
# FILTRAGE WARNINGS - CONFIGURATION COMPLÃˆTE
# ============================================================================

filterwarnings =
    # Warnings gÃ©nÃ©raux
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning
    ignore::FutureWarning
    
    # Warnings spÃ©cifiques Nextvision
    ignore::UserWarning:nextvision.*
    ignore::DeprecationWarning:nextvision.*
    
    # Warnings pytest
    ignore::pytest.PytestUnknownMarkWarning
    ignore::pytest.PytestCollectionWarning
    ignore::pytest.PytestConfigWarning
    
    # Warnings Pydantic (V1 deprecated)
    ignore::DeprecationWarning:pydantic.*
    ignore:.*validator.*:DeprecationWarning
    ignore:.*Field.*:DeprecationWarning
    ignore:.*class-based.*:DeprecationWarning
    ignore:.*json_encoders.*:DeprecationWarning
    
    # Warnings asyncio
    ignore::DeprecationWarning:asyncio.*
    ignore::RuntimeWarning:asyncio.*
    
    # Warnings imports
    ignore::ImportWarning
    ignore::ModuleNotFoundError:ignore
    
    # Warnings coverage
    ignore:.*module-not-imported.*:pytest_cov.plugin.CovReportWarning
    ignore:.*no-data-collected.*:pytest_cov.plugin.CovReportWarning

# ============================================================================
# CONFIGURATION TIMEOUTS
# ============================================================================

timeout = 60
timeout_method = thread

# ============================================================================
# VARIABLES D'ENVIRONNEMENT POUR TESTS
# ============================================================================

env = 
    NEXTVISION_ENV = test
    NEXTVISION_DEBUG = false
    NEXTVISION_CACHE_ENABLED = true
    NEXTVISION_LOG_LEVEL = WARNING
    NEXTVISION_OPENAI_API_KEY = test_key_mock
    NEXTVISION_GOOGLE_MAPS_API_KEY = test_key_mock
    PYTHONDONTWRITEBYTECODE = 1
    PYTEST_RUNNING = true

# ============================================================================
# LOGGING POUR TESTS
# ============================================================================

log_cli = false
log_cli_level = WARNING
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = reports/pytest.log
log_file_level = INFO
log_file_format = %(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d: %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# ============================================================================
# COLLECTE DES TESTS
# ============================================================================

# Patterns de fichiers Ã  ignorer
norecursedirs = 
    .git 
    .tox 
    .env 
    dist 
    build 
    south_migrations
    __pycache__
    .pytest_cache
    node_modules
    backup_*
    
# Noms de fichiers Ã  ignorer
ignore = 
    setup.py

# ==========================================================================
# Configuration optimisÃ©e pour Nextvision V3.0 - Coverage & Performance
# ==========================================================================
